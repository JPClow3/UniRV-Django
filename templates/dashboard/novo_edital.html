{% extends 'dashboard/base.html' %}

{% block title %}Novo Edital - Dashboard AgroHub{% endblock %}

{% block content %}
<div class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-4">
      <a href="{% url 'dashboard_editais' %}" class="bg-transparent hover:bg-gray-100 text-gray-700 rounded-lg px-3 py-2 text-sm transition-all inline-flex items-center gap-2">
        <i class="fas fa-arrow-left w-4 h-4"></i>
        Voltar
      </a>
      <div>
        <h1 class="text-gray-900 text-2xl font-semibold">Novo Edital</h1>
        <p class="text-gray-600">
          Configure os detalhes do edital e campos do formulário
        </p>
      </div>
    </div>

    <div class="flex gap-2">
      <button type="button" class="bg-white border-2 border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg px-4 py-2 text-sm transition-all inline-flex items-center gap-2">
        <i class="fas fa-save w-4 h-4"></i>
        Salvar Rascunho
      </button>
      <button type="submit" form="edital-form" class="bg-gradient-to-r from-unirvBlue to-agrohubBlue hover:from-unirvBlue/90 hover:to-agrohubBlue/90 rounded-lg shadow-md hover:shadow-lg transition-all inline-flex items-center justify-center gap-2 px-6 py-2 text-white font-medium">
        <i class="fas fa-paper-plane w-4 h-4"></i>
        Publicar
      </button>
    </div>
  </div>

  <!-- Form Tabs -->
  <form method="POST" id="edital-form" action="{% url 'dashboard_novo_edital' %}" class="bg-white rounded-xl border border-gray-200 p-6 space-y-6">
    {% csrf_token %}
    <div class="border-b border-gray-200">
      <div class="flex gap-4">
        <button type="button" class="tab-btn active px-4 py-2 border-b-2 border-blue-600 text-blue-600 font-medium">Informações Básicas</button>
        <button type="button" class="tab-btn px-4 py-2 text-gray-600 hover:text-gray-900">Formulário</button>
        <button type="button" class="tab-btn px-4 py-2 text-gray-600 hover:text-gray-900">Avaliação</button>
      </div>
    </div>

    <!-- Tab Content: Informações Básicas -->
    <div id="tab-informacoes" class="tab-content space-y-6">
      {% if form.errors %}
        <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4" role="alert">
          <div class="flex items-center gap-2 text-red-800 font-medium mb-2">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Há {{ form.errors|length }} erro{{ form.errors|length|pluralize }} no formulário</span>
          </div>
          <ul class="list-disc list-inside text-sm text-red-700 space-y-1">
            {% for field in form %}
              {% if field.errors %}
                <li><strong>{{ field.label }}:</strong> {{ field.errors.0 }}</li>
              {% endif %}
            {% endfor %}
            {% if form.non_field_errors %}
              {% for error in form.non_field_errors %}
                <li><strong>Erro geral:</strong> {{ error }}</li>
              {% endfor %}
            {% endif %}
          </ul>
        </div>
      {% endif %}

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <label for="{{ form.numero_edital.id_for_label }}" class="text-sm font-medium text-gray-700">
            {{ form.numero_edital.label }}
            {% if form.numero_edital.field.required %}<span class="text-red-500">*</span>{% endif %}
          </label>
          {{ form.numero_edital }}
          {% if form.numero_edital.errors %}
            <p class="text-sm text-red-600">{{ form.numero_edital.errors.0 }}</p>
          {% endif %}
        </div>

        <div class="space-y-2">
          <label for="{{ form.status.id_for_label }}" class="text-sm font-medium text-gray-700">
            {{ form.status.label }}
            {% if form.status.field.required %}<span class="text-red-500">*</span>{% endif %}
          </label>
          {{ form.status }}
          {% if form.status.errors %}
            <p class="text-sm text-red-600">{{ form.status.errors.0 }}</p>
          {% endif %}
        </div>
      </div>

      <div class="space-y-2">
        <label for="{{ form.titulo.id_for_label }}" class="text-sm font-medium text-gray-700">
          {{ form.titulo.label }}
          {% if form.titulo.field.required %}<span class="text-red-500">*</span>{% endif %}
        </label>
        {{ form.titulo }}
        {% if form.titulo.errors %}
          <p class="text-sm text-red-600">{{ form.titulo.errors.0 }}</p>
        {% endif %}
      </div>

      <div class="space-y-2">
        <label for="{{ form.url.id_for_label }}" class="text-sm font-medium text-gray-700">
          {{ form.url.label }}
          {% if form.url.field.required %}<span class="text-red-500">*</span>{% endif %}
        </label>
        {{ form.url }}
        {% if form.url.errors %}
          <p class="text-sm text-red-600">{{ form.url.errors.0 }}</p>
        {% endif %}
      </div>

      <div class="space-y-2">
        <label for="{{ form.entidade_principal.id_for_label }}" class="text-sm font-medium text-gray-700">
          {{ form.entidade_principal.label }}
          {% if form.entidade_principal.field.required %}<span class="text-red-500">*</span>{% endif %}
        </label>
        {{ form.entidade_principal }}
        {% if form.entidade_principal.errors %}
          <p class="text-sm text-red-600">{{ form.entidade_principal.errors.0 }}</p>
        {% endif %}
      </div>

      <div class="space-y-2">
        <label for="{{ form.objetivo.id_for_label }}" class="text-sm font-medium text-gray-700">
          {{ form.objetivo.label }}
          {% if form.objetivo.field.required %}<span class="text-red-500">*</span>{% endif %}
        </label>
        {{ form.objetivo }}
        {% if form.objetivo.errors %}
          <p class="text-sm text-red-600">{{ form.objetivo.errors.0 }}</p>
        {% endif %}
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="space-y-2">
          <label for="{{ form.start_date.id_for_label }}" class="text-sm font-medium text-gray-700">
            {{ form.start_date.label }}
            {% if form.start_date.field.required %}<span class="text-red-500">*</span>{% endif %}
          </label>
          {{ form.start_date }}
          {% if form.start_date.errors %}
            <p class="text-sm text-red-600">{{ form.start_date.errors.0 }}</p>
          {% endif %}
        </div>

        <div class="space-y-2">
          <label for="{{ form.end_date.id_for_label }}" class="text-sm font-medium text-gray-700">
            {{ form.end_date.label }}
            {% if form.end_date.field.required %}<span class="text-red-500">*</span>{% endif %}
          </label>
          {{ form.end_date }}
          {% if form.end_date.errors %}
            <p class="text-sm text-red-600">{{ form.end_date.errors.0 }}</p>
          {% endif %}
          <p class="text-xs text-gray-500">Deixe em branco para fluxo contínuo</p>
        </div>
      </div>

      <!-- Additional fields from EditalForm -->
      {% for field in form %}
        {% if field.name not in 'numero_edital,status,titulo,url,entidade_principal,objetivo,start_date,end_date' %}
          <div class="space-y-2">
            <label for="{{ field.id_for_label }}" class="text-sm font-medium text-gray-700">
              {{ field.label }}
              {% if field.field.required %}<span class="text-red-500">*</span>{% endif %}
            </label>
            {{ field }}
            {% if field.help_text %}
              <p class="text-xs text-gray-500">{{ field.help_text }}</p>
            {% endif %}
            {% if field.errors %}
              <p class="text-sm text-red-600">{{ field.errors.0 }}</p>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <!-- Tab Content: Formulário -->
    <div id="tab-formulario" class="tab-content space-y-6 hidden">
      <p class="text-gray-600">Conteúdo do formulário será adicionado aqui.</p>
    </div>

    <!-- Tab Content: Avaliação -->
    <div id="tab-avaliacao" class="tab-content space-y-6 hidden">
      <p class="text-gray-600">Conteúdo da avaliação será adicionado aqui.</p>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tabs = document.querySelectorAll('.tab-btn');
  const contents = document.querySelectorAll('.tab-content');

  // Helper to show specific tab
  function activateTab(index) {
    // Reset buttons
    tabs.forEach(btn => {
      btn.classList.remove('active', 'border-b-2', 'border-blue-600', 'text-blue-600');
      btn.classList.add('text-gray-600');
    });
    
    // Hide all contents
    contents.forEach(content => content.classList.add('hidden'));

    // Activate clicked button
    // Ensure the clicked element exists before accessing classList
    if(tabs[index]) {
        tabs[index].classList.add('active', 'border-b-2', 'border-blue-600', 'text-blue-600');
        tabs[index].classList.remove('text-gray-600');
    }
    
    // Show content
    if(contents[index]) {
        contents[index].classList.remove('hidden');
    }
  }

  tabs.forEach((btn, index) => {
    btn.addEventListener('click', (e) => {
        e.preventDefault(); // Prevent form submission if button is inside form
        activateTab(index);
    });
  });

  // Show first tab by default
  if (contents.length > 0) {
    activateTab(0);
  }
});
</script>
{% endblock %}

