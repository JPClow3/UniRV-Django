{% extends 'dashboard/base.html' %}

{% block title %}{% if user.is_staff %}Projetos Submetidos{% else %}Meus Projetos{% endif %} - Dashboard YPETEC{% endblock %}

{% block content %}
<div class="space-y-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <div>
      <h1 class="text-gray-900 mb-2 text-2xl font-semibold">
        {% if user.is_staff %}Projetos Submetidos{% else %}Meus Projetos{% endif %}
      </h1>
      <p class="text-gray-600">
        {% if user.is_staff %}
          Gerencie e avalie projetos submetidos aos editais
        {% else %}
          Acompanhe o status dos seus projetos
        {% endif %}
      </p>
    </div>
    {% if not user.is_staff %}
      <a href="{% url 'dashboard_submeter_projeto' %}" class="size-lg bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 rounded-full shadow-md hover:shadow-lg transition-all inline-flex items-center justify-center gap-2 px-6 py-3 text-white font-medium">
        <i class="fas fa-plus w-4 h-4"></i>
        Novo Projeto
      </a>
    {% endif %}
  </div>

  <!-- Stats -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    <div class="bg-white rounded-xl border border-gray-200 p-4">
      <div class="text-gray-600 mb-1 text-sm">Total</div>
      <div class="text-gray-900 text-2xl font-bold">{{ stats.total }}</div>
    </div>
    <div class="bg-white rounded-xl border border-gray-200 p-4">
      <div class="text-gray-600 mb-1 text-sm">Em Avaliação</div>
      <div class="text-gray-900 text-2xl font-bold">{{ stats.em_avaliacao }}</div>
    </div>
    <div class="bg-white rounded-xl border border-gray-200 p-4">
      <div class="text-gray-600 mb-1 text-sm">Aprovados</div>
      <div class="text-gray-900 text-2xl font-bold">{{ stats.aprovados }}</div>
    </div>
    <div class="bg-white rounded-xl border border-gray-200 p-4">
      <div class="text-gray-600 mb-1 text-sm">Taxa de Aprovação</div>
      <div class="text-gray-900 text-2xl font-bold">{{ stats.approval_rate }}</div>
    </div>
  </div>

  <!-- Search and Filters -->
  <div class="bg-white rounded-xl border border-gray-200 p-4">
    <form method="GET" class="flex flex-col sm:flex-row gap-4">
      <div class="flex-1 relative">
        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i>
        <input
          type="text"
          name="search"
          placeholder="Buscar projetos..."
          class="pl-10 w-full"
        value="{{ search_query }}"
        >
      </div>

      <select name="edital" class="w-full sm:w-48">
        <option value="">Todos os editais</option>
      <option value="1" {% if edital_filter == '1' %}selected{% endif %}>Edital 001/2024</option>
      <option value="2" {% if edital_filter == '2' %}selected{% endif %}>Edital 002/2024</option>
      <option value="3" {% if edital_filter == '3' %}selected{% endif %}>Edital 003/2024</option>
      </select>

      <select name="status" class="w-full sm:w-48">
        <option value="">Todos</option>
      <option value="Pendente" {% if status_filter == 'Pendente' %}selected{% endif %}>Pendente</option>
      <option value="Em Avaliação" {% if status_filter == 'Em Avaliação' %}selected{% endif %}>Em Avaliação</option>
      <option value="Aprovado" {% if status_filter == 'Aprovado' %}selected{% endif %}>Aprovado</option>
      <option value="Reprovado" {% if status_filter == 'Reprovado' %}selected{% endif %}>Reprovado</option>
      </select>
    </form>

  {% if search_query or edital_filter or status_filter %}
  <div class="mt-4 flex flex-wrap items-center gap-2 text-sm text-gray-600">
    <i class="fas fa-filter"></i>
    <span class="font-medium">Filtros ativos:</span>
    {% if search_query %}
      <span class="badge bg-blue-100 text-blue-700 px-2 py-1 rounded">{{ search_query }}</span>
    {% endif %}
    {% if edital_filter %}
      <span class="badge bg-green-100 text-green-700 px-2 py-1 rounded">Edital {{ edital_filter|default:"" }}</span>
    {% endif %}
    {% if status_filter %}
      <span class="badge bg-purple-100 text-purple-700 px-2 py-1 rounded">{{ status_filter }}</span>
    {% endif %}
  </div>
  {% endif %}

  {% if projects|length == 0 %}
  <div class="mt-4 px-4 py-3 rounded-xl bg-blue-50 border border-blue-200 text-blue-800 flex gap-3 items-start">
    <i class="fas fa-info-circle mt-1"></i>
    <div>
      <p class="font-semibold">Nenhum projeto encontrado com os filtros aplicados.</p>
      <p class="text-sm text-blue-700/80">Tente outros critérios de busca ou limpe os filtros para visualizar todos os projetos.</p>
      <a href="{% url 'dashboard_projetos' %}" class="inline-flex items-center gap-2 mt-3 px-3 py-1.5 rounded-lg bg-blue-600 text-white text-sm font-medium hover:bg-blue-700 transition">
        <i class="fas fa-undo-alt text-xs"></i>
        Limpar filtros
      </a>
    </div>
  </div>
  {% endif %}
  </div>

  <!-- Projects Table -->
  <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead class="bg-gray-50 border-b border-gray-200">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome do Projeto</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Edital</th>
            {% if user.is_staff %}
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Proponente</th>
            {% endif %}
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data de Submissão</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nota</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for project in projects %}
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ project.name }}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ project.edital_label }}</td>
            {% if user.is_staff %}
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ project.proponente }}</td>
            {% endif %}
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ project.submitted_on }}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="badge {% if project.status == 'Aprovado' %}bg-green-100 text-green-700{% elif project.status == 'Em Avaliação' %}bg-blue-100 text-blue-700{% elif project.status == 'Reprovado' %}bg-red-100 text-red-700{% else %}bg-yellow-100 text-yellow-700{% endif %} border-none px-3 py-1 text-sm">
                {{ project.status }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              {% if project.note %}
                <span class="font-mono">{{ project.note }}</span>
              {% else %}
                <span class="text-gray-400">-</span>
              {% endif %}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex gap-2">
                <button class="p-2 hover:bg-gray-100 rounded-lg transition-colors" title="Visualizar">
                  <i class="fas fa-eye text-gray-400"></i>
                </button>
                <button class="p-2 hover:bg-gray-100 rounded-lg transition-colors" title="Download">
                  <i class="fas fa-download text-gray-400"></i>
                </button>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="{% if user.is_staff %}7{% else %}6{% endif %}" class="px-6 py-10">
              <div class="empty-state-table text-center">
                <div class="empty-state-icon">
                  <i class="fas fa-folder-open"></i>
                </div>
                <h3>Nenhum projeto encontrado</h3>
                <p>Revise os filtros aplicados ou cadastre um novo projeto.</p>
                <div class="flex justify-center gap-3 mt-4">
                  {% if not user.is_staff %}
                  <a href="{% url 'dashboard_submeter_projeto' %}" class="btn bg-gradient-to-r from-green-500 to-blue-600 text-white">
                    Novo Projeto
                  </a>
                  {% endif %}
                  <a href="{% url 'dashboard_projetos' %}" class="btn variant-outline text-gray-700 border border-gray-300">
                    Limpar filtros
                  </a>
                </div>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

