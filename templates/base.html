<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AgroHub - UNIRV{% endblock %}</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="{% block meta_description %}AgroHub UniRV - Portal de editais de fomento, oportunidades de negócio e programas de apoio para o agronegócio{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}editais, fomento, agronegócio, UniRV, oportunidades, pesquisa, inovação{% endblock %}">
    <meta name="author" content="UniRV - Universidade de Rio Verde">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="{% block og_title %}{% block title_og %}AgroHub - UNIRV{% endblock %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Portal de editais de fomento e oportunidades para o agronegócio{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="og:site_name" content="AgroHub UniRV">
    {% load static %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;500i;800&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="{% if request.resolver_match.url_name == 'edital_detail' or request.resolver_match.url_name == 'edital_detail_slug' %}page-detail{% endif %}">

<!-- Skip to main content link for accessibility (only on list pages) -->
{% if request.resolver_match.url_name != 'edital_detail' and request.resolver_match.url_name != 'edital_detail_slug' %}
<a href="#main-content" class="skip-link">Pular para o conteúdo principal</a>
{% endif %}

<header class="navbar">
    <div class="navbar-left">
        <a href="{% url 'editais_index' %}" class="brand-logo" aria-label="Agrohub UniRV">
            <img src="{% static 'img/Logo.svg' %}" alt="Agrohub UniRV logo">
        </a>
    </div>

    <button class="mobile-menu-toggle" aria-label="Abrir menu de navegação" aria-expanded="false" aria-controls="navbar-menu">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
    </button>

    <nav class="navbar-right" id="navbar-menu">
        <ul>
            <li><a href="{% url 'editais_index' %}" class="{% if request.resolver_match.url_name == 'editais_index' %}active{% endif %}">EDITAIS DE FOMENTO</a></li>
            <li>
                <a href="{% url 'edital_create' %}" 
                   class="navbar-action-btn"
                   title="Criar novo edital"
                   aria-label="Criar novo edital">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                    <span>Criar Edital</span>
                </a>
            </li>
            {% if user.is_authenticated and user.is_staff %}
            <li>
                <a href="{% url 'admin_dashboard' %}" 
                   class="navbar-action-btn"
                   title="Dashboard administrativo"
                   aria-label="Dashboard administrativo">
                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>
</header>

{% comment %}Curva verde removida para seguir padrão minimalista UniRV{% endcomment %}

<div class="container">
    {% block breadcrumb %}{% endblock %}
    <main class="content-area" id="main-content">
        {% if messages %}
            <div class="messages" role="alert" aria-live="polite" style="display: none;">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}" data-message-tag="{{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
            <script>
                // Convert Django messages to toast notifications (T046 - Complete integration)
                (function() {
                    // Wait for showToast function to be available
                    function processMessages() {
                        const messages = document.querySelectorAll('.messages .alert');
                        if (messages.length === 0) return;
                        
                        // If showToast is not available yet, wait a bit
                        if (typeof showToast !== 'function') {
                            setTimeout(processMessages, 100);
                            return;
                        }
                        
                        messages.forEach(function(messageEl) {
                            const messageText = messageEl.textContent.trim();
                            const messageTag = messageEl.getAttribute('data-message-tag') || 'info';
                            
                            // Map Django message tags to toast types
                            // Django default tags: debug, info, success, warning, error
                            let toastType = 'success';
                            if (messageTag === 'error' || messageTag === 'danger') {
                                toastType = 'error';
                            } else if (messageTag === 'warning') {
                                toastType = 'warning';
                            } else if (messageTag === 'info' || messageTag === 'debug') {
                                toastType = 'info';
                            } else if (messageTag === 'success') {
                                toastType = 'success';
                            }
                            
                            // Show toast notification
                            showToast(messageText, toastType);
                            
                            // Mark message as processed to avoid duplicates
                            messageEl.setAttribute('data-processed', 'true');
                        });
                    }
                    
                    // Process messages when DOM is ready
                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', processMessages);
                    } else {
                        processMessages();
                    }
                })();
            </script>
        {% endif %}

        {% block content %}{% endblock %}
    </main>
</div>

<script src="{% static 'js/main.js' %}"></script>
</body>
</html>
