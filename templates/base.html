<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    {% load static tailwind_tags editais_filters %}
    {% load compress %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}AgroHub UniRV - Inovação e Tecnologia{% endblock %}
    </title>

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="{% block meta_description %}AgroHub UniRV - Centro de Inovação e Tecnologia da Universidade de Rio Verde. Conectando pesquisa, startups, indústria e produtores rurais para impulsionar o Agro 4.0.{% endblock %}"
    />
    <meta
      name="keywords"
      content="{% block meta_keywords %}AgroHub, UniRV, inovação, agronegócio, startups, incubadora, InovaLab, FINEP, Rio Verde{% endblock %}"
    />
    <meta name="author" content="UniRV - Universidade de Rio Verde" />
    <meta name="robots" content="index, follow" />
    <meta name="theme-color" content="#2563EB" />
    <link rel="canonical" href="{% block canonical_url %}{{ request.build_absolute_uri }}{% endblock %}" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="{% block twitter_title %}AgroHub UniRV - Inovação e Tecnologia{% endblock %}" />
    <meta name="twitter:description" content="{% block twitter_description %}AgroHub UniRV - Centro de Inovação e Tecnologia da Universidade de Rio Verde. Conectando pesquisa, startups, indústria e produtores rurais para impulsionar o Agro 4.0.{% endblock %}" />
    <meta name="twitter:image" content="{% block twitter_image_url %}{{ request.build_absolute_uri|slice:":-1" }}{% static 'img/Logo AgroHub.svg' %}{% endblock %}" />

    <!-- Open Graph / Social Media Meta Tags -->
    <meta
      property="og:title"
      content="{% block og_title %}AgroHub UniRV{% endblock %}"
    />
    <meta
      property="og:description"
      content="{% block og_description %}Centro de Inovação e Tecnologia da UniRV. Transformação digital, automação e sustentabilidade no campo.{% endblock %}"
    />
    <meta property="og:type" content="{% block og_type %}website{% endblock %}" />
    <meta
      property="og:url"
      content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}"
    />
    <meta property="og:site_name" content="AgroHub UniRV" />
    {% block og_image %}
    <meta property="og:image" content="{% block og_image_url %}{{ request.build_absolute_uri|slice:":-1" }}{% static 'img/Logo AgroHub.svg' %}{% endblock %}" />
    <meta property="og:image:alt" content="{% block og_image_alt %}AgroHub UniRV - Logo do Centro de Inovação e Tecnologia{% endblock %}" />
    <meta property="og:image:width" content="{% block og_image_width %}512{% endblock %}" />
    <meta property="og:image:height" content="{% block og_image_height %}512{% endblock %}" />
    <meta property="og:image:type" content="{% block og_image_type %}image/svg+xml{% endblock %}" />
    {% endblock %}
    {# Note: compress tag requires django-compressor to be installed (listed in requirements.txt) #}
    
    <!-- Prefetch likely next-page resources for better navigation performance -->
    <link rel="prefetch" href="{% url 'editais_index' %}" as="document" />
    <!-- Prefetch login page for faster navigation -->
    <link rel="prefetch" href="{% url 'login' %}" as="document" />
    <!-- Preload critical fonts - only Regular weight for above-the-fold content -->
    <!-- SemiBold font loads on-demand when needed (font-display: swap handles this) -->
    <link
      rel="preload"
      as="font"
      type="font/ttf"
      href="{% static 'fonts/Montserrat-Regular.ttf' %}"
      crossorigin="anonymous"
    />
    <link rel="icon" type="image/svg+xml" href="{% static 'img/favicon.svg' %}" />
    
    <!-- Structured Data (JSON-LD) for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "AgroHub UniRV",
      "url": "{{ request.build_absolute_uri|slice:":-1" }}{% url 'home' %}",
      "logo": "{{ request.build_absolute_uri|slice:":-1" }}{% static 'img/Logo AgroHub.svg' %}",
      "description": "Centro de Inovação e Tecnologia da Universidade de Rio Verde. Conectando pesquisa, startups, indústria e produtores rurais para impulsionar o Agro 4.0.",
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+55-62-98172-9376",
        "contactType": "customer service",
        "email": "agrohub@unirv.edu.br"
      },
      "sameAs": [
        "https://www.unirv.edu.br"
      ]
    }
    </script>
    
    {% tailwind_css %}
    <!-- Native animations CSS (replaces GSAP for simple fade-ins) -->
    <link rel="stylesheet" href="{% static 'css/animations.css' %}">
    <!-- Print styles -->
    <link rel="stylesheet" href="{% static 'css/print.css' %}" media="print">
    <!-- Font Awesome (local vendor assets - no CDN) -->
    <link rel="stylesheet" href="{% static 'vendor/fontawesome/css/all.min.css' %}" crossorigin="anonymous" />
    <!-- Material Icons Outlined (for modern UI elements) -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    {% block extra_head %}{% endblock %}
  </head>
  {% with current_url=request.resolver_match.url_name|default:"" transparent_header=request.resolver_match.url_name|is_transparent_header %}
  <body
    class="min-h-screen flex flex-col bg-gray-50 overflow-x-hidden{% if transparent_header %} page-detail{% endif %}"
    data-page="{% block page_id %}{% endblock %}"
  >
    <header
      class="site-header no-print bg-surface-light/95 backdrop-blur-xl border-b border-gray-100 text-gray-800 shadow-sm sticky top-0 z-50 w-full full-bleed {% if transparent_header %}header-transparent{% endif %}"
    >
      <div
        class="absolute top-0 left-0 right-0 w-full bg-gradient-to-r from-darkblue to-primary h-1 z-10"
      ></div>
      <nav class="relative z-10 site-nav">
        <div class="flex justify-between items-center h-16 w-full max-w-7xl mx-auto px-6 lg:px-12 gap-8 flex-nowrap">
          <!-- Logo -->
          <a
            href="{% url 'home' %}"
            class="flex items-center shrink-0 mr-auto"
            aria-label="AgroHub UniRV - Centro de Inovação e Tecnologia"
          >
            <img 
              src="{% static 'img/Logo AgroHub.svg' %}" 
              alt="AgroHub UniRV Logo" 
              class="w-16 h-16 md:w-24 md:h-24 shrink-0" 
              width="96" 
              height="96" 
              fetchpriority="high"
              loading="eager"
              decoding="async"
            />
          </a>

          <!-- Desktop Navigation -->
          <div class="hidden md:flex items-center gap-8 shrink-0 ml-auto whitespace-nowrap flex-nowrap">
            <a
              href="{% url 'home' %}"
              class="nav-link transition-colors font-medium text-sm whitespace-nowrap shrink-0 {% if current_url == 'home' %}text-primary font-semibold{% else %}text-text-light hover:text-primary{% endif %}"
            >
              Início
            </a>
            <a
              href="{% url 'ambientes_inovacao' %}"
              class="nav-link transition-colors font-medium text-sm whitespace-nowrap shrink-0 {% if current_url == 'ambientes_inovacao' %}text-primary font-semibold{% else %}text-text-muted hover:text-primary{% endif %}"
            >
              Ambientes de Inovação
            </a>
            <a
              href="{% url 'editais_index' %}"
              class="nav-link transition-colors font-medium text-sm whitespace-nowrap shrink-0 {% if current_url == 'editais_index' or current_url|startswith:'edital_' %}text-primary font-semibold{% else %}text-text-muted hover:text-primary{% endif %}"
            >
              Editais
            </a>
            <a
              href="{% url 'startups_showcase' %}"
              class="nav-link transition-colors font-medium text-sm whitespace-nowrap shrink-0 {% if current_url == 'startups_showcase' or current_url == 'dashboard_startups' %}text-primary font-semibold{% else %}text-text-muted hover:text-primary{% endif %}"
            >
              Startups
            </a>
            {% if user.is_authenticated %}
            <a
              href="{% url 'dashboard_home' %}"
              class="bg-darkblue hover:bg-primary text-white px-6 py-2.5 rounded-full font-semibold text-sm transition shadow-lg shadow-blue-900/20"
            >
              DASHBOARD
            </a>
            <form action="{% url 'admin:logout' %}" method="post" class="inline">
              {% csrf_token %}
              <button
                type="submit"
                class="text-text-muted hover:text-red-600 transition-colors font-medium text-sm cursor-pointer"
                title="Sair"
                aria-label="Sair da conta"
              >
                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
              </button>
            </form>
            {% else %}
            <a
              href="{% url 'login' %}"
              class="bg-darkblue hover:bg-primary text-white px-6 py-2.5 rounded-full font-semibold text-sm transition shadow-lg shadow-blue-900/20"
            >
              LOGIN
            </a>
            {% endif %}
          </div>

          <!-- Mobile menu button -->
          <button
            class="mobile-menu-toggle md:hidden p-2"
            aria-label="Abrir menu de navegação"
            aria-expanded="false"
            aria-controls="navbar-menu"
          >
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </button>
        </div>

        <!-- Mobile Navigation -->
        <div class="navbar-right md:hidden" id="navbar-menu" style="z-index: 50;">
          <ul class="flex flex-col"><li>
              <a
                href="{% url 'home' %}"
                class="nav-link block px-4 py-3 min-h-[44px] flex items-center {% if current_url == 'home' %}nav-active{% else %}text-gray-700 hover:text-green-600 hover:bg-green-50{% endif %}"
                {% if current_url == 'home' %}aria-current="page"{% endif %}
                >Início</a
              >
            </li>
            <li>
              <a
                href="{% url 'ambientes_inovacao' %}"
                class="nav-link block px-4 py-3 min-h-[44px] flex items-center {% if current_url == 'ambientes_inovacao' %}nav-active{% else %}text-gray-700 hover:text-green-600 hover:bg-green-50{% endif %}"
                {% if current_url == 'ambientes_inovacao' %}aria-current="page"{% endif %}
                >Ambientes de Inovação</a
              >
            </li>
            <li>
              <a
                href="{% url 'editais_index' %}"
                class="nav-link block px-4 py-3 min-h-[44px] flex items-center {% if current_url == 'editais_index' or current_url|startswith:'edital_' %}nav-active{% else %}text-gray-700 hover:text-green-600 hover:bg-green-50{% endif %}"
                {% if current_url == 'editais_index' or current_url|startswith:'edital_' %}aria-current="page"{% endif %}
                >Editais</a
              >
            </li>
            <li>
              <a
                href="{% url 'startups_showcase' %}"
                class="nav-link block px-4 py-3 min-h-[44px] flex items-center {% if current_url == 'startups_showcase' or current_url == 'dashboard_startups' %}nav-active{% else %}text-gray-700 hover:text-green-600 hover:bg-green-50{% endif %}"
                {% if current_url == 'startups_showcase' or current_url == 'dashboard_startups' %}aria-current="page"{% endif %}
                >Startups</a
              >
            </li>
            {% if user.is_authenticated %}
            <li>
              <a
                href="{% url 'dashboard_home' %}"
                class="nav-cta block mx-4 mt-4 text-center min-h-[44px] flex items-center justify-center"
              >
                Dashboard
              </a>
            </li>
            <li>
              <form action="{% url 'admin:logout' %}" method="post" class="block">
                {% csrf_token %}
                <button
                  type="submit"
                  class="w-full text-left px-4 py-3 min-h-[44px] flex items-center text-red-600 hover:bg-red-50 font-medium cursor-pointer"
                  aria-label="Sair da conta"
                >
                  <i class="fas fa-sign-out-alt mr-2" aria-hidden="true"></i>Sair
                </button>
              </form>
            </li>
            {% else %}
            <li>
              <a
                href="{% url 'login' %}"
                class="nav-cta block mx-4 mt-4 text-center min-h-[44px] flex items-center justify-center"
              >
                Login
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
      </nav>
    </header>

    <main class="flex-1 w-full">
      <div>
        <div class="content-area" id="main-content">
          <!-- Toast Container -->
          <div id="toast-container" class="fixed top-4 right-4 z-[100] flex flex-col gap-3 max-w-md w-full md:w-auto" role="region" aria-live="polite" aria-label="Notificações"></div>
          
          {% if messages %}
          <script>
            // Initialize toasts from Django messages
            // Wait for showToast function to be available (loaded from main.js)
            function initDjangoMessages() {
              const messages = [
                {% for message in messages %}
                {
                  text: {{ message|escapejs }},
                  type: '{{ message.tags|default:"info" }}'
                }{% if not forloop.last %},{% endif %}
                {% endfor %}
              ];
              
              // Check if showToast is available, if not wait and retry
              if (typeof showToast === 'function') {
                // Small delay to ensure DOM is ready
                setTimeout(function() {
                  messages.forEach(function(msg) {
                    // Map Django message tags to toast types
                    let toastType = 'success';
                    if (msg.type === 'error' || msg.type === 'danger') {
                      toastType = 'error';
                    } else if (msg.type === 'warning') {
                      toastType = 'warning';
                    } else if (msg.type === 'info' || msg.type === 'debug') {
                      toastType = 'info';
                    } else if (msg.type === 'success') {
                      toastType = 'success';
                    }
                    
                    // Set duration based on type
                    let duration = 5000;
                    if (toastType === 'error') {
                      duration = 7000;
                    } else if (toastType === 'warning') {
                      duration = 5000;
                    } else if (toastType === 'info') {
                      duration = 4000;
                    }
                    
                    showToast(msg.text, toastType, duration);
                  });
                  }, 100);
              } else {
                window._toastRetryCount = (window._toastRetryCount || 0) + 1;
                // Retry after a short delay if showToast is not yet loaded
                if (window._toastRetryCount < 50) { // Max 5 seconds
                  setTimeout(initDjangoMessages, 100);
                }
              }
            }
            
            // Start initialization when DOM is ready
            if (document.readyState === 'loading') {
              document.addEventListener('DOMContentLoaded', initDjangoMessages);
            } else {
              initDjangoMessages();
            }
          </script>
          {% endif %} {% block content %}{% endblock %}
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer
      class="site-footer no-print text-white w-full full-bleed bg-darkblue pt-20 pb-10 relative"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-16">
          <!-- Logo & Description -->
          <div>
            <div class="flex items-center gap-2 mb-6">
              <span class="material-icons-outlined text-secondary text-3xl">spa</span>
              <div class="flex flex-col">
                <span class="font-display font-bold text-lg text-white leading-tight">agrohub</span>
                <span class="text-[10px] tracking-widest text-blue-200 font-semibold">UNIRV</span>
              </div>
            </div>
            <p class="text-blue-200 text-sm leading-relaxed mb-6">
              Centro de Inovação e Tecnologia apoiado pela FINEP, voltado à
              transformação digital do agronegócio em Goiás. Conectamos
              pesquisa, startups e o setor produtivo.
            </p>
          </div>

          <!-- Links Rápidos -->
          <div>
            <h4 class="font-bold text-lg mb-6">Links Rápidos</h4>
            <ul class="space-y-3 text-sm text-blue-200">
              <li>
                <a
                  href="{% url 'home' %}"
                  class="hover:text-white hover:translate-x-1 transition-transform inline-block"
                >
                  Início
                </a>
              </li>
              <li>
                <a
                  href="{% url 'ambientes_inovacao' %}"
                  class="hover:text-white hover:translate-x-1 transition-transform inline-block"
                >
                  Ambientes de Inovação
                </a>
              </li>
              <li>
                <a
                  href="{% url 'editais_index' %}"
                  class="hover:text-white hover:translate-x-1 transition-transform inline-block"
                >
                  Editais
                </a>
              </li>
              <li>
                <a
                  href="{% url 'startups_showcase' %}"
                  class="hover:text-white hover:translate-x-1 transition-transform inline-block"
                >
                  Startups
                </a>
              </li>
            </ul>
          </div>

          <!-- Contato -->
          <div>
            <h4 class="font-bold text-lg mb-6">Contato</h4>
            <ul class="space-y-4 text-sm text-blue-200">
              <li class="flex items-center gap-3">
                <span class="material-icons-outlined text-secondary text-sm">email</span>
                <a href="mailto:agrohub@unirv.edu.br" class="hover:text-white transition-colors">
                  agrohub@unirv.edu.br
                </a>
              </li>
              <li class="flex items-center gap-3">
                <span class="material-icons-outlined text-secondary text-sm">phone</span>
                <a href="tel:+5562981729376" class="hover:text-white transition-colors">
                  (62) 98172-9376
                </a>
              </li>
              <li class="flex items-center gap-3">
                <span class="material-icons-outlined text-secondary text-sm">language</span>
                <a
                  href="https://www.unirv.edu.br"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="hover:text-white transition-colors"
                >
                  www.unirv.edu.br
                </a>
              </li>
            </ul>
          </div>

          <!-- Newsletter -->
          <div>
            <h4 class="font-bold text-lg mb-6">Fique Atualizado</h4>
            <p class="text-sm text-blue-200 mb-4">Receba notícias sobre os editais.</p>
            <form class="flex flex-col gap-2">
              <input
                class="bg-white/10 border border-white/20 rounded px-4 py-2 text-sm text-white placeholder-blue-300 focus:outline-none focus:ring-2 focus:ring-secondary"
                placeholder="Seu e-mail"
                type="email"
                aria-label="Seu e-mail"
              />
              <button
                type="button"
                class="bg-secondary text-white font-bold py-2 rounded text-sm hover:bg-green-600 transition cursor-not-allowed opacity-70"
                disabled
                title="Em breve"
              >
                Inscrever-se
              </button>
            </form>
          </div>
        </div>

        <!-- Bottom Bar -->
        <div class="border-t border-white/10 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-blue-300">
          <p>© 2025 AgroHub UniRV. Todos os direitos reservados.</p>
          <div class="flex gap-6 mt-4 md:mt-0">
            <button type="button" class="hover:text-white transition cursor-not-allowed opacity-50" title="Em breve" disabled>
              Política de Privacidade
            </button>
            <button type="button" class="hover:text-white transition cursor-not-allowed opacity-50" title="Em breve" disabled>
              Termos de Uso
            </button>
          </div>
        </div>
      </div>

      <!-- Back to Top Button -->
      <a
        href="#"
        class="absolute bottom-8 right-8 bg-primary hover:bg-blue-600 text-white p-3 rounded-full shadow-lg transition animate-bounce"
        aria-label="Voltar ao topo"
      >
        <span class="material-icons-outlined">arrow_upward</span>
      </a>
    </footer>


    <!-- Global animation libraries - conditionally loaded only on pages that need animations -->
    {% if current_url == 'home' or current_url|startswith:'edital_' or current_url == 'startups_showcase' or current_url == 'ambientes_inovacao' or current_url == 'editais_index' or current_url == 'startups' %}
    <!-- Native animations for simple fade-ins (Intersection Observer) -->
    {% if HAS_COMPRESSOR %}
    {% compress js %}
    {% if DEBUG %}<script src="{% static 'js/animations-native.js' %}" defer></script>{% else %}<script src="{% static 'js/animations-native.min.js' %}" defer></script>{% endif %}
    {% endcompress %}
    {% else %}
    {% if DEBUG %}<script src="{% static 'js/animations-native.js' %}" defer></script>{% else %}<script src="{% static 'js/animations-native.min.js' %}" defer></script>{% endif %}
    {% endif %}
    
    <!-- GSAP only for complex animations (counters, timeline progress) on home page (local vendor) -->
    {% if current_url == 'home' %}
    <script src="{% static 'vendor/gsap/gsap.min.js' %}" defer crossorigin="anonymous"></script>
    <script src="{% static 'vendor/gsap/ScrollTrigger.min.js' %}" defer crossorigin="anonymous"></script>
    {% if HAS_COMPRESSOR %}
    {% compress js %}
    {% if DEBUG %}<script src="{% static 'js/animations.js' %}" defer></script>{% else %}<script src="{% static 'js/animations.min.js' %}" defer></script>{% endif %}
    {% endcompress %}
    {% else %}
    {% if DEBUG %}<script src="{% static 'js/animations.js' %}" defer></script>{% else %}<script src="{% static 'js/animations.min.js' %}" defer></script>{% endif %}
    {% endif %}
    {% endif %}
    {% endif %}

    {% if HAS_COMPRESSOR %}
    {% compress js %}
    {% if DEBUG %}<script src="{% static 'js/main.js' %}" defer></script>{% else %}<script src="{% static 'js/main.min.js' %}" defer></script>{% endif %}
    {% endcompress %}
    {% else %}
    {% if DEBUG %}<script src="{% static 'js/main.js' %}" defer></script>{% else %}<script src="{% static 'js/main.min.js' %}" defer></script>{% endif %}
    {% endif %}
    {% block extra_js %}{% endblock %}
    {% endwith %}
  </body>
  </html>
