{% extends 'base.html' %}

{% block title %}{{ edital.titulo }} - AgroHub UniRV{% endblock %}

{% block meta_description %}{{ edital.objetivo|truncatewords:30|striptags }} - Edital de fomento {% if edital.entidade_principal %}pela {{ edital.entidade_principal }}{% endif %}. Status: {{ edital.get_status_display }}.{% endblock %}

{% block og_title %}{{ edital.titulo }}{% endblock %}

{% block og_description %}{{ edital.objetivo|truncatewords:25|striptags }}{% endblock %}

{% block content %}
    {% if user.is_authenticated %}
        {% csrf_token %}
    {% endif %}

<div class="page-header">
    <div class="page-header-top">
        <h1>{{ edital.titulo }}</h1>
        {% if user.is_authenticated %}
            <button class="favorite-btn {% if is_favorited %}favorited{% endif %}"
                    data-edital-id="{{ edital.pk }}"
                    aria-label="{% if is_favorited %}Remover dos favoritos{% else %}Adicionar aos favoritos{% endif %}">
                <i class="fas fa-star" aria-hidden="true"></i>
                <span class="favorite-text">{% if is_favorited %}Favoritado{% else %}Favoritar{% endif %}</span>
            </button>
        {% endif %}
    </div>
    <div class="page-meta">
        {% if edital.numero_edital %}
        <span class="page-meta-item">
            <i class="fas fa-file-alt" aria-hidden="true"></i>
            <strong>Nº:</strong> {{ edital.numero_edital }}
        </span>
        {% endif %}
        {% if edital.entidade_principal %}
        <span class="page-meta-item">
            <i class="fas fa-building" aria-hidden="true"></i>
            <strong>Entidade:</strong> {{ edital.entidade_principal }}
        </span>
        {% endif %}
        <span class="page-meta-item">
            <i class="fas fa-tag" aria-hidden="true"></i>
            <strong>Status:</strong> <span class="status-badge status-{{ edital.status }}">{{ edital.get_status_display }}</span>
        </span>
        {% if edital.created_by %}
        <span class="page-meta-item">
            <i class="fas fa-user" aria-hidden="true"></i>
            <strong>Criado por:</strong> {{ edital.created_by.username }}
        </span>
        {% endif %}
        <span class="page-meta-item">
            <i class="fas fa-calendar" aria-hidden="true"></i>
            <strong>Atualizado:</strong> <time datetime="{{ edital.data_atualizacao|date:'Y-m-d' }}">{{ edital.data_atualizacao|date:"d/m/Y" }}</time>
        </span>
    </div>
</div>


{% if edital.objetivo_safe %}
<div class="edital-section" id="objetivo">
  <h3>1. Objetivo do Edital</h3>
  <div class="prose">{{ edital.objetivo_safe }}</div>
</div>
{% endif %}

{% if edital.etapas_safe %}
<div class="edital-section" id="etapas">
  <h3>2. Etapas do Edital</h3>
  <div class="prose">{{ edital.etapas_safe }}</div>
</div>
{% endif %}

{% if edital.recursos_safe %}
<div class="edital-section" id="recursos-financeiros">
  <h3>3. Cronograma / Recursos</h3>
  <div class="prose">{{ edital.recursos_safe }}</div>
</div>
{% endif %}

{% if edital.itens_financiaveis_safe or edital.criterios_elegibilidade_safe or edital.criterios_avaliacao_safe %}
<div class="edital-section" id="itens-financiaveis">
  <h3>4. Itens Financiáveis / Elegibilidade / Avaliação</h3>
  {% if edital.itens_financiaveis_safe %}
    <h4>Itens Financiáveis</h4>
    <div class="prose">{{ edital.itens_financiaveis_safe }}</div>
  {% endif %}
  {% if edital.criterios_elegibilidade_safe %}
    <h4>Critérios de Elegibilidade</h4>
    <div class="prose">{{ edital.criterios_elegibilidade_safe }}</div>
  {% endif %}
  {% if edital.criterios_avaliacao_safe %}
    <h4>Critérios de Avaliação</h4>
    <div class="prose">{{ edital.criterios_avaliacao_safe }}</div>
  {% endif %}
</div>
{% endif %}

{% if edital.itens_essenciais_observacoes_safe %}
<div class="edital-section" id="itens-essenciais">
  <h3>5. Itens Essenciais / Observações</h3>
  <div class="prose">{{ edital.itens_essenciais_observacoes_safe }}</div>
</div>
{% endif %}

{% if edital.detalhes_unirv_safe %}
<div class="edital-section" id="pontos-unirv">
  <h3>6. Pontos para a UniRV</h3>
  <div class="prose">{{ edital.detalhes_unirv_safe }}</div>
</div>
{% endif %}

    {% if edital.created_by or edital.updated_by %}
        <div class="activity-info">
            {% if edital.created_by %}
                <span class="created-by">
        <i class="fas fa-user-plus" aria-hidden="true"></i>
        Criado por <strong>{{ edital.created_by.username }}</strong> em {{ edital.data_criacao|date:"d/m/Y H:i" }}
    </span>
            {% endif %}
            {% if edital.updated_by and edital.updated_by != edital.created_by %}
                <span class="updated-by">
        <i class="fas fa-user-edit" aria-hidden="true"></i>
        Última atualização por <strong>{{ edital.updated_by.username }}</strong>
    </span>
            {% endif %}
        </div>
    {% endif %}

<p class="disclaimer">
    <i class="fas fa-info-circle" aria-hidden="true"></i>
    Consulte o edital oficial para detalhes completos.
    <a href="{{ edital.url }}" target="_blank" rel="noopener noreferrer">Acessar edital oficial</a>
</p>

<div class="detail-actions">
  <a href="{{ edital.url }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary">
      <i class="fas fa-external-link-alt" aria-hidden="true"></i> Acessar Edital
  </a>
  {% if user.is_authenticated %}
  <a href="{% url 'edital_update' edital.pk %}" class="btn btn-secondary">
      <i class="fas fa-edit" aria-hidden="true"></i> Editar
  </a>
  {% endif %}
  <a href="{% url 'editais_index' %}" class="btn btn-outline">
      <i class="fas fa-arrow-left" aria-hidden="true"></i> Voltar
  </a>
</div>
{% endblock %}
