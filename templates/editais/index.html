{% extends 'base.html' %}

{% block title %}Editais de Fomento - AgroHub UniRV{% endblock %}

{% block meta_description %}Explore editais de fomento abertos para o agronegócio. Encontre oportunidades de financiamento, pesquisa e inovação para seu projeto.{% endblock %}

{% block meta_keywords %}editais fomento, agronegócio, financiamento rural, pesquisa agrícola, inovação, UniRV{% endblock %}

{% block content %}
<div class="editais-header">
    <div class="search-section">
        <div class="search-header">
            <div class="title-group">
                <h1 class="main-title">Editais de Fomento</h1>
                <p class="search-subtitle">
                    Encontramos <strong>{{ total_count }}</strong> 
                    edita{{ total_count|pluralize:"l,is" }}
                </p>
            </div>

            <div class="header-actions">
                <a href="{% url 'export_editais_csv' %}{% if request.GET %}?{{ request.GET.urlencode }}{% endif %}"
                   class="btn-icon"
                   title="Exportar editais para CSV"
                   aria-label="Exportar editais para CSV">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    <span class="sr-only">Exportar editais para CSV</span>
                </a>
                <a href="{% url 'edital_create' %}" 
                   class="btn-icon btn-icon-primary"
                   title="Cadastrar edital"
                   aria-label="Cadastrar edital">
                    <i class="fas fa-plus" aria-hidden="true"></i>
                    <span class="sr-only">Cadastrar edital</span>
                </a>
            </div>
        </div>

        <div class="filters-container">
            <form method="GET" class="search-form" role="search" aria-label="Buscar editais">
                <div class="search-input-row">
                    <div class="search-input-wrapper">
                        <i class="fas fa-search search-icon" aria-hidden="true"></i>
                        <input type="text" 
                            name="search" 
                            value="{{ search_query }}"
                            placeholder="Buscar por título, entidade ou número do edital..." 
                            class="search-input"
                            aria-label="Campo de busca"
                            autocomplete="off">
                        {% if search_query %}
                            <button type="button" class="search-clear" aria-label="Limpar busca">
                                <i class="fas fa-times" aria-hidden="true"></i>
                            </button>
                        {% else %}
                            <div class="keyboard-hint" aria-hidden="true">
                                <kbd>Ctrl</kbd> + <kbd>K</kbd>
                            </div>
                        {% endif %}
                    </div>
                    <button type="submit" class="search-submit" aria-label="Buscar editais">
                        <i class="fas fa-search" aria-hidden="true"></i>
                    </button>
                </div>

                <div class="filter-row">
                    <label class="sr-only" for="status-filter">Filtrar por status</label>
                    <select id="status-filter" name="status" class="status-filter" aria-label="Filtrar por status">
                        <option value="">Todos os Status</option>
                        {% for value, display in status_choices %}
                            <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ display }}</option>
                        {% endfor %}
                    </select>
                </div>
            </form>

        </div>

        <!-- Active filters display -->
    {% if search_query or status_filter %}
        <div class="active-filters">
            <span class="active-filters-label">Filtros ativos:</span>
            {% if search_query %}
                <span class="filter-tag">
                    Busca: "{{ search_query }}"
                    <a href="?{% if status_filter %}status={{ status_filter }}{% endif %}" class="filter-remove" aria-label="Remover filtro de busca">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </a>
                </span>
            {% endif %}
            {% if status_filter %}
                <span class="filter-tag">
                    Status: {{ status_filter|title }}
                    <a href="?{% if search_query %}search={{ search_query }}{% endif %}" class="filter-remove" aria-label="Remover filtro de status">
                        <i class="fas fa-times" aria-hidden="true"></i>
                    </a>
                </span>
            {% endif %}
            <a href="{% url 'editais_index' %}" class="filter-clear-all">
                <i class="fas fa-redo" aria-hidden="true"></i>
                Limpar todos
            </a>
        </div>
    {% endif %}
</div>

<div class="editais-grid" role="list" aria-label="Lista de editais">
    {% for edital in page_obj %}
        <article class="edital-card" role="listitem">
            <div class="card-header">
                <span class="status-badge status-{{ edital.status }}" aria-label="Status do edital">{{ edital.get_status_display }}</span>
                {% if edital.numero_edital %}
                    <span class="edital-number">{{ edital.numero_edital }}</span>
                {% endif %}
            </div>

            <h3 class="edital-title">
                <a href="{{ edital.get_absolute_url }}">{{ edital.titulo|truncatewords:12 }}</a>
            </h3>

            {% if edital.entidade_principal %}
                <p class="edital-entity">
                    <i class="fas fa-building" aria-hidden="true"></i>
                    <span>{{ edital.entidade_principal }}</span>
                </p>
            {% endif %}

            <p class="edital-objective">
                {{ edital.objetivo|default_if_none:''|truncatewords:25|default:"Sem descrição disponível." }}
            </p>

            <div class="card-footer">
                <small class="start-date">
                    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                    <time datetime="{{ edital.start_date|date:'Y-m-d' }}">
                        {% if edital.start_date %}
                            Abertura: {{ edital.start_date|date:"d/m/Y" }}
                        {% else %}
                            Data não informada
                        {% endif %}
                    </time>
                </small>

                <div class="card-actions">
                    <a href="{{ edital.get_absolute_url }}" class="btn btn-ghost" aria-label="Ver detalhes de {{ edital.titulo }}">
                        Ver Detalhes
                    </a>
                    {% if user.is_authenticated %}
                    <a href="{% url 'edital_update' edital.pk %}" class="btn btn-ghost-secondary" aria-label="Editar {{ edital.titulo }}">
                        Editar
                    </a>
                    {% endif %}
                </div>
            </div>
        </article>
    {% empty %}
        <div class="empty-state" role="status">
            <div class="empty-state-icon">
                <i class="fas fa-search" aria-hidden="true"></i>
            </div>
            <h3>Nenhum edital encontrado</h3>
            {% if search_query or status_filter %}
                <p>Não encontramos editais que correspondam aos seus filtros. Tente ajustar sua busca ou remover os filtros aplicados.</p>
                <div class="empty-state-actions">
                    <a href="{% url 'editais_index' %}" class="btn btn-outline">
                        <i class="fas fa-redo" aria-hidden="true"></i> Limpar Filtros
                    </a>
                    {% if user.is_authenticated %}
                    <a href="{% url 'edital_create' %}" class="btn btn-primary">
                        <i class="fas fa-plus" aria-hidden="true"></i> Cadastrar Novo Edital
                    </a>
                    {% endif %}
                </div>
            {% else %}
                <p>Ainda não há editais cadastrados no sistema. Seja o primeiro a adicionar um edital de fomento!</p>
                <div class="empty-state-actions">
                    {% if user.is_authenticated %}
                    <a href="{% url 'edital_create' %}" class="btn btn-primary">
                        <i class="fas fa-plus" aria-hidden="true"></i> Cadastrar Primeiro Edital
                    </a>
                    {% else %}
                    <a href="{% url 'admin:login' %}" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt" aria-hidden="true"></i> Fazer Login para Cadastrar
                    </a>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    {% endfor %}
</div>

{% if page_obj.has_other_pages %}
    <nav class="pagination-container" aria-label="Navegação de páginas">
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}"
                   class="page-link" aria-label="Ir para primeira página">&laquo; Primeira</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}"
                   class="page-link" aria-label="Ir para página anterior">Anterior</a>
            {% endif %}

            <span class="page-info" aria-current="page">
                Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}"
                   class="page-link" aria-label="Ir para próxima página">Próxima</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if status_filter %}&status={{ status_filter }}{% endif %}"
                   class="page-link" aria-label="Ir para última página">Última &raquo;</a>
            {% endif %}
        </div>
    </nav>
{% endif %}
{% endblock %}

