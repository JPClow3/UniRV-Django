{% extends 'base.html' %}
{% load static thumbnail_safe editais_filters %}

{% block title %}{{ startup.name }} - AgroHub UniRV{% endblock %}

{% block meta_description %}{{ startup.description|truncatewords:30|striptags|default:"Startup incubada no AgroHub UniRV" }}{% endblock %}

{% block og_title %}{{ startup.name }}{% endblock %}

{% block og_description %}{{ startup.description|truncatewords:25|striptags|default:"Startup incubada no AgroHub UniRV" }}{% endblock %}

{% block twitter_title %}{{ startup.name }} - AgroHub UniRV{% endblock %}

{% block twitter_description %}{{ startup.description|truncatewords:25|striptags|default:"Startup incubada no AgroHub UniRV" }}{% endblock %}

{% block og_image %}
  {% if startup.logo %}
    {% if startup.logo|is_svg %}
      {# SVG files: use original URL directly #}
      {% with base_url=request.build_absolute_uri|default:""|slice:":-1" %}
        <meta property="og:image" content="{{ base_url }}{{ startup.logo.url }}" />
        <meta property="og:image:alt" content="{{ startup.name }} - Logo da Startup" />
        <meta name="twitter:image" content="{{ base_url }}{{ startup.logo.url }}" />
      {% endwith %}
    {% else %}
      {# Raster images: try thumbnail first, fallback to original #}
      {% safe_thumbnail startup.logo "detail_thumb" as thumb %}
      {% if thumb %}
        {% with base_url=request.build_absolute_uri|default:""|slice:":-1" %}
          <meta property="og:image" content="{{ base_url }}{{ thumb.url }}" />
          <meta property="og:image:alt" content="{{ startup.name }} - Logo da Startup" />
          <meta property="og:image:width" content="{{ thumb.width }}" />
          <meta property="og:image:height" content="{{ thumb.height }}" />
          <meta property="og:image:type" content="image/jpeg" />
          <meta name="twitter:image" content="{{ base_url }}{{ thumb.url }}" />
        {% endwith %}
      {% else %}
        {# Thumbnail generation failed or unavailable, use original image #}
        {% with base_url=request.build_absolute_uri|default:""|slice:":-1" %}
          <meta property="og:image" content="{{ base_url }}{{ startup.logo.url }}" />
          <meta property="og:image:alt" content="{{ startup.name }} - Logo da Startup" />
          <meta name="twitter:image" content="{{ base_url }}{{ startup.logo.url }}" />
        {% endwith %}
      {% endif %}
    {% endif %}
  {% else %}
    {{ block.super }}
  {% endif %}
{% endblock %}

{% block content %}
<!-- Hero Header -->
{% with subtitle=startup.description|truncatewords:30|default:"" %}
{% if startup.logo %}
{% include 'components/page_hero.html' with badge_label="Startup" title=startup.name subtitle=subtitle logo_template="startups/detail_hero_logo.html" meta_template="components/hero_meta_startup.html" %}
{% else %}
{% include 'components/page_hero.html' with badge_label="Startup" title=startup.name subtitle=subtitle meta_template="components/hero_meta_startup.html" %}
{% endif %}
{% endwith %}

<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="max-w-6xl mx-auto">
    <div class="mb-4 flex justify-end no-print">
      <button type="button" id="print-btn" class="inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all">
        <i class="fas fa-print"></i>
        Imprimir
      </button>
    </div>

    <div class="bg-white p-6 md:p-8 rounded-xl shadow-sm mb-8 border border-gray-100">
      <h2 class="text-primary text-xl font-bold mb-4">Informações da Startup</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <h3 class="text-gray-900 font-semibold mb-2">Categoria</h3>
          <p class="text-gray-600">{{ startup.get_category_display }}</p>
        </div>
        <div>
          <h3 class="text-gray-900 font-semibold mb-2">Fase de maturidade</h3>
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium {{ startup.status|phase_badge_class }}">
            {{ startup.get_phase_display }}
          </span>
        </div>
        {% if startup.proponente %}
        <div>
          <h3 class="text-gray-900 font-semibold mb-2">Responsável</h3>
          <p class="text-gray-600">{{ startup.proponente.get_full_name|default:startup.proponente.username }}</p>
        </div>
        {% endif %}
        {% if startup.submitted_on %}
        <div>
          <h3 class="text-gray-900 font-semibold mb-2">Data de Entrada</h3>
          <p class="text-gray-600">{{ startup.submitted_on|date:"d/m/Y" }}</p>
        </div>
        {% endif %}
        {% if startup.website %}
        <div>
          <h3 class="text-gray-900 font-semibold mb-2">Website</h3>
          <p class="text-gray-600">
            <a href="{{ startup.website }}" target="_blank" rel="noopener noreferrer" class="text-primary hover:text-primary-hover font-medium">
              {{ startup.website }}
            </a>
          </p>
        </div>
        {% endif %}
        {% if startup.contato or startup.proponente.email %}
        <div>
          <h3 class="text-gray-900 font-semibold mb-2">Contato</h3>
          <div class="text-gray-600 space-y-2">
            {% if startup.proponente and startup.proponente.email %}
              <div class="flex items-start gap-2">
                <i class="fas fa-envelope text-secondary mt-0.5" aria-hidden="true"></i>
                <a href="mailto:{{ startup.proponente.email }}" class="text-primary hover:text-primary-hover font-medium break-all">
                  {{ startup.proponente.email }}
                </a>
              </div>
            {% endif %}
            {% if startup.contato %}
              <div class="flex items-start gap-2">
                <i class="fas fa-address-card text-secondary mt-0.5" aria-hidden="true"></i>
                <div class="min-w-0">
                  {{ startup.contato|linebreaks }}
                </div>
              </div>
            {% endif %}
          </div>
        </div>
        {% endif %}
        {% if startup.incubacao_start_date %}
        <div>
          <h3 class="text-gray-900 font-semibold mb-2">Data de Início da Incubação</h3>
          <p class="text-gray-600">{{ startup.incubacao_start_date|date:"d/m/Y" }}</p>
        </div>
        {% endif %}
        {% if startup.tags.all %}
        <div>
          <h3 class="text-gray-900 font-semibold mb-2">Tags</h3>
          <div class="flex flex-wrap gap-2">
            {% for tag in startup.tags.all %}
            <span class="inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-medium">
              {{ tag.name }}
            </span>
            {% endfor %}
          </div>
        </div>
        {% endif %}
        {% if startup.edital %}
        <div>
          <h3 class="text-gray-900 font-semibold mb-2">Edital Relacionado</h3>
          <a href="{% url 'edital_detail_slug' startup.edital.slug %}" class="text-primary hover:text-primary-hover font-medium">
            {{ startup.edital.titulo|truncatewords:10 }}
          </a>
        </div>
        {% endif %}
      </div>
    </div>

    {% if startup.description %}
    <div class="bg-white p-6 md:p-8 rounded-xl shadow-sm mb-8 border border-gray-100">
      <h2 class="text-primary text-xl font-bold mb-4">Descrição</h2>
      <div class="prose max-w-none text-gray-700">
        <p>{{ startup.description|linebreaks }}</p>
      </div>
    </div>
    {% endif %}

    <div class="bg-white p-6 md:p-8 rounded-xl shadow-sm border border-gray-100">
      <div class="flex flex-col sm:flex-row gap-4 justify-between items-center">
        <a href="{% url 'startups_showcase' %}" class="inline-flex items-center gap-2 px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
          <i class="fas fa-arrow-left"></i>
          Voltar para Startups
        </a>
        {% if user.is_staff %}
        <a href="{% url 'dashboard_startup_update' startup.pk %}" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-lg hover:bg-blue-700 transition-colors">
          <i class="fas fa-edit"></i>
          Editar Startup
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const printBtn = document.getElementById('print-btn');
    if (printBtn) {
      printBtn.addEventListener('click', function() {
        window.print();
      });
    }
  });
</script>
{% endblock %}

